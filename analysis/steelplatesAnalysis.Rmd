---
title: "steel-plates-Analysis"
author: "Alex Xiong"
date: "11/23/2020"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(dplyr)
library(glmnet)

library(missForest)
library(gapminder)
library(tidyverse)
library(skimr)

library(e1071)
library(ISLR)

library(gbm)

library(class)
```


```{r warning=FALSE}
setwd('./..')
steelPlates = read.csv(paste0(getwd(), "/data/steel-plates.csv"), header = TRUE)
steelPlates$Class <- steelPlates$Class - 1
steelPlates = select(steelPlates, -c(V28, V29, V30, V31, V32, V33))
```


```{r warning=FALSE}
table(steelPlates$Class)

# Fit LASSO for feature selection

x <- as.matrix(select(steelPlates, -c(Class)))
y <- as.matrix(select(steelPlates, c(Class))) 

lasso_steelplates <- cv.glmnet(x, y, family = "binomial", )

lambda_min <- lasso_steelplates$lambda.min

lasso_fit <- glmnet(x, y,
                    family = "binomial", lambda = lambda_min)

lasso_fit$beta
lambda_min
plot(lasso_steelplates)
sum(ifelse(predict(lasso_fit, newx = x, type = "link") >= 0, 1, 0) == y)/length(y)
table(ifelse(predict(lasso_fit, newx = x, type = "link") >= 0, 1, 0), y)
```


```{r}
new_dummy_steelplates <- select(steelPlates, -c(V4, V8, V22))
new_dummy_steelplates$Class <- as.factor(new_dummy_steelplates$Class)

# Cross validation for random forest 
mtry_vec <- c(2, 3, 4, 5, 6, 8, 10, 12)

rf_steelplates_cv <- matrix(rep(0, length(mtry_vec) * 5), ncol = 5)

count <- 1
for(mt in mtry_vec){
  
  rf <- randomForest(Class ~., data = new_dummy_steelplates, mtry = mt, ntree = 600)

  some <- rf$err.rate

  ntree <- which.min(some[,1])
    
  rf_steelplates_cv[count, ] <- c(mt, ntree, rf$err.rate[ntree,])
    
  count <- count + 1
}

pos_of_min_rf <- which.min(rf_steelplates_cv[, 3])

rf_steelplates_cv[pos_of_min_rf, ]
## Output
## 12.00000000 231.00000000   0.16383308   0.07492114   0.33135215
```


```{r}
### Logistic Regression
steelLogReg <- glm(Class ~ ., data = steelPlates, family = "binomial")
#summary(wageLogReg)

new_dummy_steelplates <- select(steelPlates, -c(V4, V8, V22))
steelLogRegLasso <- glm(Class ~ ., data = new_dummy_steelplates, family = "binomial")
#summary(wageLogRegLasso)

table(ifelse(predict(steelLogReg) > 0, 1, 0), steelPlates$Class)
table(ifelse(predict(steelLogRegLasso) > 0, 1, 0), new_dummy_steelplates$Class)
```


```{r}
steelSVM <- svm(Class ~ ., data = new_dummy_steelplates, kernel = "linear", cost = 0.1)
svm.pred <- predict(steelSVM, new_dummy_steelplates)
table(ifelse(svm.pred > 0, 1, 0), new_dummy_steelplates$Class)

steelSVM <- svm(Class ~ ., data = new_dummy_steelplates, kernel = "polynomial", gamma=1, cost = 0.1)
svm.pred <- predict(steelSVM, new_dummy_steelplates)
table(ifelse(svm.pred > 0, 1, 0), new_dummy_steelplates$Class)

steelSVM <- svm(Class ~ ., data = new_dummy_steelplates, kernel = "radial", gamma=1, cost = 0.1)
svm.pred <- predict(steelSVM, new_dummy_steelplates)
table(ifelse(svm.pred > 0, 1, 0), new_dummy_steelplates$Class)
```


```{r}
# Perform gradient boosting, get predictions, and MSE
gbm <- gbm(formula = Class ~ .,
  distribution = "bernoulli",
  data = new_dummy_steelplates,
  n.trees = 10000,
  interaction.depth = 1,
  shrinkage = 0.01)
    
gbm_predict <- predict(gbm, newdata = new_dummy_steelplates)
table(ifelse(gbm_predict > 0, 1, 0), new_dummy_steelplates$Class)
```


```{r}
knn.predict <- knn(train = new_dummy_steelplates, test = new_dummy_steelplates, cl = new_dummy_steelplates$Class, k=16)
table(knn.predict, new_dummy_steelplates$Class)
```


```{r}
deleteData <- function(data, response, percentLeft) {
  
  resp <- data[response]
  data <- select(data, -all_of(response))
  
  rowNum <- nrow(data)
  colNum <- ncol(data)
  items = rowNum * colNum
  itemsToDel = as.integer((1 - percentLeft) * items)
  
  dim_data <- dim(data)
  
  all_possible <- expand.grid(1:dim_data[1], 1:dim_data[2])
  
  sample_NA <- sample(1:dim(all_possible)[1], itemsToDel)
  
  for (samp in sample_NA) {
    delrowNum <- all_possible[samp, ][[1]]
    delcolNum <- all_possible[samp, ][[2]]
    data[[delrowNum, delcolNum]] <- NA
  }
  
  return(cbind(data, resp))
}

steelplate_NA <- deleteData(steelPlates, "Class", 0.95)
```

```{r warning=FALSE}
missForest(steelplate_NA)

```










